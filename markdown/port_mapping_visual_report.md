# 📊 子模块端口映射可视化报告

本报告以文本图表的形式展示各子模块RTL代码与Excel表格中端口定义的对应关系。

## 🎯 总体匹配状态

```
模块匹配状态分布
┌─────────────────────────────────────────┐
│  ✅ 完全匹配: 3个模块 (60%)              │
│  ❌ 部分匹配: 2个模块 (40%)              │
└─────────────────────────────────────────┘

完全匹配模块:
├─ Protocol_Arbiter  (80/80 端口)
├─ Function_Arbiter  (50/50 端口)
└─ Command_Arbiter   (43/43 端口)

部分匹配模块:
├─ Pre_All          (27/44 端口)
└─ BP_If            (9/15 端口)
```

## 📈 端口数量对比图表

```
各模块端口数量对比

端口数量
   ↑
80 ┤ ███ ███ ███                                    Excel端口数
   ┤ ███ ███ ███                                    RTL端口数  
   ┤ ███ ███ ███                                    匹配端口数
60 ┤ ███ ███ ███
   ┤ ███ ███ ███
   ┤ ███ ███ ███ ███
40 ┤ ███ ███ ███ ███
   ┤ ███ ███ ███ ███
   ┤ ███ ███ ███ ███
20 ┤ ███ ███ ███ ███ ███
   ┤ ███ ███ ███ ███ ███
 0 └─┴───┴───┴───┴───┴───────────────────────────→
     P   F   C   Pre  BP                        模块
     r   u   o   _    _
     o   n   m   A    I
     t   c   m   l    f
     o   t   a   l
     c   i   n
     o   o   d
     l   n

图例:
███ Excel: 80, 50, 43, 44, 15
███ RTL:   80, 50, 43, 27,  9
███ 匹配:  80, 50, 43, 27,  9
```

## 🔍 Protocol_Arbiter 详细端口映射

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    Protocol_Arbiter 模块端口映射示意图                      │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐                                    ┌─────────────────┐
│   Excel定义     │ ←─────────── 端口映射 ──────────→ │   RTL实现       │
└─────────────────┘                                    └─────────────────┘

🕐 时钟复位接口:
┌─────────────────┐                                    ┌─────────────────┐
│ ddrc_clk (行2)  │ ←─────────────────────────────────→ │ ddrc_clk (行32) │
│ ddrc_rst_n(行3) │ ←─────────────────────────────────→ │ddrc_rst_n(行33) │
└─────────────────┘                                    └─────────────────┘

⚡ ACT/PRE命令接口:
┌─────────────────┐                                    ┌─────────────────┐
│actpre_pa_cmd_vld│ ←─────────────────────────────────→ │actpre_pa_cmd_vld│
│    (行4)        │                                    │    (行34)       │
│actpre_pa_cmd_rdy│ ←─────────────────────────────────→ │actpre_pa_cmd_rdy│
│    (行5)        │                                    │    (行35)       │
│actpre_pa_cmd_typ│ ←─────────────────────────────────→ │actpre_pa_cmd_typ│
│    (行6)        │                                    │    (行36)       │
│actpre_pa_cmd_hqo│ ←─────────────────────────────────→ │actpre_pa_cmd_hqo│
│    (行7)        │                                    │    (行37)       │
└─────────────────┘                                    └─────────────────┘

📖 RD/WR命令接口:
┌─────────────────┐                                    ┌─────────────────┐
│rdwr_pa_cmd_vld  │ ←─────────────────────────────────→ │rdwr_pa_cmd_vld  │
│    (行8)        │                                    │    (行38)       │
│rdwr_pa_cmd_rdy  │ ←─────────────────────────────────→ │rdwr_pa_cmd_rdy  │
│    (行9)        │                                    │    (行39)       │
│rdwr_pa_cmd_type │ ←─────────────────────────────────→ │rdwr_pa_cmd_type │
│    (行10)       │                                    │    (行40)       │
│rdwr_pa_cmd_hqos │ ←─────────────────────────────────→ │rdwr_pa_cmd_hqos │
│    (行11)       │                                    │    (行41)       │
└─────────────────┘                                    └─────────────────┘

🔌 DFI输出接口:
┌─────────────────┐                                    ┌─────────────────┐
│ pa_cmd_vld      │ ←─────────────────────────────────→ │ pa_cmd_vld      │
│    (行70)       │                                    │    (行100)      │
│pa_dfi_cmd_type  │ ←─────────────────────────────────→ │pa_dfi_cmd_type  │
│    (行71)       │                                    │    (行101)      │
│pa_dfi_cmd_rank  │ ←─────────────────────────────────→ │pa_dfi_cmd_rank  │
│    (行72)       │                                    │    (行102)      │
│pa_dfi_cmd_phase │ ←─────────────────────────────────→ │pa_dfi_cmd_phase │
│    (行73)       │                                    │    (行103)      │
│pa_dfi_cmd_sc    │ ←─────────────────────────────────→ │pa_dfi_cmd_sc    │
│    (行74)       │                                    │    (行104)      │
└─────────────────┘                                    └─────────────────┘
```

## 📋 端口匹配状态矩阵

```
各模块端口匹配状态矩阵

                  端口名  方向   位宽   数量   完整性
                  匹配   匹配   匹配   匹配   匹配
Protocol_Arbiter   ✓     ✓     △     ✓     ✓
Function_Arbiter   ✓     ✓     △     ✓     ✓  
Command_Arbiter    ✓     ✓     △     ✓     ✓
Pre_All           ✓     ✓     △     ✗     ✗
BP_If             ✓     ✓     △     ✗     ✗

图例:
✓ 完全匹配    △ 部分匹配    ✗ 不匹配
```

## 🔧 Function_Arbiter 关键端口映射

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                   Function_Arbiter 模块关键端口映射                         │
└─────────────────────────────────────────────────────────────────────────────┘

🎛️ 功能仲裁接口:
┌─────────────────┐                                    ┌─────────────────┐
│ func_req (行49) │ ←─────────────────────────────────→ │ func_req (行70) │
│ func_hqos(行50) │ ←─────────────────────────────────→ │ func_hqos(行71) │
│ func_load(行51) │ ←─────────────────────────────────→ │ func_load(行72) │
└─────────────────┘                                    └─────────────────┘

🔄 MRR/ZQ控制信号:
┌─────────────────┐                                    ┌─────────────────┐
│mrr_zq_high_req  │ ←─────────────────────────────────→ │mrr_zq_high_req  │
│    (行33)       │                                    │    (行54)       │
│mrr_zq_low_req   │ ←─────────────────────────────────→ │mrr_zq_low_req   │
│    (行34)       │                                    │    (行55)       │
│mrr_zq_high_load │ ←─────────────────────────────────→ │mrr_zq_high_load │
│    (行35)       │                                    │    (行56)       │
│mrr_zq_low_load  │ ←─────────────────────────────────→ │mrr_zq_low_load  │
│    (行36)       │                                    │    (行57)       │
│ zq_load_h(行37) │ ←─────────────────────────────────→ │ zq_load_h(行58) │
│mrrx_load_h(行38)│ ←─────────────────────────────────→ │mrrx_load_h(行59)│
│mrr4_load_h(行39)│ ←─────────────────────────────────→ │mrr4_load_h(行60)│
└─────────────────┘                                    └─────────────────┘
```

## ⚠️ 问题模块详细分析

### Pre_All 模块 (27/44 端口匹配)

```
状态: 🔴 部分匹配

匹配情况:
┌─────────────────────────────────┐
│ Excel定义: 44个端口             │
│ RTL实现:   27个端口             │
│ 匹配:      27个端口             │
│ 缺失:      17个端口             │
└─────────────────────────────────┘

缺失端口影响:
❌ 17个Excel定义的端口在RTL中未找到
❌ 可能影响模块完整性
❌ 需要确认是否为设计变更
```

### BP_If 模块 (9/15 端口匹配)

```
状态: 🔴 部分匹配

匹配情况:
┌─────────────────────────────────┐
│ Excel定义: 15个端口             │
│ RTL实现:   9个端口              │
│ 匹配:      9个端口              │
│ 缺失:      6个端口              │
└─────────────────────────────────┘

缺失端口影响:
❌ 6个Excel定义的端口在RTL中未找到
❌ 可能影响背压接口功能
❌ 需要确认是否为设计简化
```

## 🎨 位宽格式差异可视化

```
位宽表示格式对比

Excel格式        RTL格式         含义
┌─────────────┐  ┌─────────────┐
│ [1-1:0]     │→ │ 0           │  单bit信号
│ [2-1:0]     │→ │ 2-1:0       │  2bit信号
│ RK_NUM*SC_NUM│→ │RK_NUM*SC_NUM│  参数化位宽
│             │  │-1:0         │  (缺少-1:0)
└─────────────┘  └─────────────┘

格式统一建议:
✅ 统一使用RTL格式: [width-1:0]
✅ 单bit信号使用: 无位宽声明
✅ 参数化位宽: 确保包含-1:0后缀
```

## 📊 模块完整性评分

```
模块完整性评分卡

┌─────────────────┬─────┬─────┬─────┬─────┬─────┬─────┐
│ 模块名          │端口名│方向 │位宽 │数量 │完整 │总分 │
├─────────────────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ Protocol_Arbiter│ 100 │ 100 │ 60  │ 100 │ 100 │ 92  │
│ Function_Arbiter│ 100 │ 100 │ 60  │ 100 │ 100 │ 92  │
│ Command_Arbiter │ 100 │ 100 │ 60  │ 100 │ 100 │ 92  │
│ Pre_All         │ 100 │ 100 │ 60  │  61 │  61 │ 76  │
│ BP_If           │ 100 │ 100 │ 60  │  60 │  60 │ 76  │
└─────────────────┴─────┴─────┴─────┴─────┴─────┴─────┘

评分标准:
🟢 90-100分: 优秀 (完全匹配)
🟡 70-89分:  良好 (基本匹配)
🔴 <70分:    需要改进
```

## 🎯 修复优先级

```
修复任务优先级排序

高优先级 🔴
├─ 1. 确认Pre_All模块缺失的17个端口
├─ 2. 确认BP_If模块缺失的6个端口
└─ 3. 验证端口功能完整性

中优先级 🟡
├─ 4. 统一位宽表示格式
├─ 5. 更新Excel文档中的位宽定义
└─ 6. 同步参数名称使用

低优先级 🟢
├─ 7. 优化端口命名规范
├─ 8. 添加端口描述信息
└─ 9. 完善文档注释
```

## 📁 相关文件索引

```
文件结构
├─ 📄 port_annotation_detailed_report.md  (详细标注报告)
├─ 📄 port_mapping_summary.md             (映射关系总结)
├─ 📄 port_mapping_visual_report.md       (可视化报告)
├─ 🔧 annotate_module_ports.py            (标注脚本)
├─ 📊 Protocol_Arbiter (22).xlsx          (Excel规范)
└─ 📁 rtl/                                (RTL源码目录)
   ├─ protocol_arbiter.sv
   ├─ function_arbiter.v
   ├─ command_arbiter.v
   ├─ pre_all.v
   └─ bp_if.v
```

---

**📅 生成时间**: $(date)  
**🔧 工具版本**: annotate_module_ports.py v1.0  
**📊 数据源**: Protocol_Arbiter (22).xlsx  
**📈 报告版本**: v1.0